<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0c10" />
  <!-- iOS PWA polish -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
  <title>Study Quiz</title>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Study Quiz</h1>
        <div class="sub">Dynamic, weighted quizzes with rewards — installable & offline.</div>
      </div>
      <div class="hud">
        <span class="pill xp">XP: <b id="hud-xp">0</b> • Lv <b id="hud-lvl">1</b></span>
        <span class="pill streak">Streak: <b id="hud-streak">0</b> ×<b id="hud-mult">1.0</b></span>
        <span class="pill hearts">Hearts: <b id="hud-hearts">3</b>/3</span>
        <span class="pill">Quest: <b id="hud-quest">0/100 XP</b></span>
      </div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-tab="quiz">Quiz</button>
      <button class="tab" data-tab="manage">Manage</button>
      <button class="tab" data-tab="about">About</button>
    </nav>

    <main id="view-quiz" class="grid g2">
      <section class="card">
        <div class="row aend between">
          <div>
            <div class="muted xsmall">Current module</div>
            <div id="module-label" class="strong">–</div>
          </div>
          <div class="row wrap gap">
            <select id="module-select"></select>
            <label class="muted xsmall" for="target">Questions</label>
            <input id="target" type="number" min="1" max="100" value="10" class="w90" />
            <button id="start" class="primary">Start Quiz</button>
            <button id="stop" class="ghost" style="display:none">Stop</button>
          </div>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="muted xsmall">Mastery</div><div class="val" id="kpi-mastery">0%</div><div class="progress"><i id="bar-mastery" style="width:0%"></i></div></div>
          <div class="kpi"><div class="muted xsmall">Accuracy</div><div class="val" id="kpi-accuracy">–</div><div class="muted xsmall" id="kpi-ratio"></div></div>
          <div class="kpi"><div class="muted xsmall">Session</div><div class="val" id="kpi-session">0/0</div><div class="muted xsmall" id="kpi-total"></div></div>
        </div>

        <div id="panel" class="mt"></div>
      </section>

      <aside class="card">
        <div class="muted">Tips</div>
        <ul>
          <li>Wrong answers reset to <span class="mono">box 1</span> and reappear sooner.</li>
          <li>Correct answers move up a box (towards 5). Mastery = box ≥ 4.</li>
          <li>Progress and bank live in your browser (<span class="mono">localStorage</span>). Export regularly.</li>
        </ul>
        <div class="footer">Works offline after first load • Install via Share → Add to Home Screen</div>
      </aside>
    </main>

    <section id="view-manage" class="grid g2" style="display:none">
      <div class="card">
        <h3>Modules</h3>
        <div class="row wrap gap">
          <select id="m-module"></select>
          <button id="m-reset">Reset progress</button>
          <button id="m-export">Export bank</button>
          <label class="muted">Import JSON:</label>
          <button id="m-import">Apply</button>
        </div>
        <textarea id="m-json" rows="12" placeholder="Paste question bank JSON here…"></textarea>
        <div class="muted xsmall mt">Format: { modules: { "Module Name": [ { id, type:"mc"|"text", q, choices?, answer, altAnswers?, explanation? } ] } }</div>
      </div>

      <div class="card">
        <h3>Add Question</h3>
        <div class="grid two gap">
          <label>Type
            <select id="q-type"><option value="mc">Multiple choice</option><option value="text">Short text</option></select>
          </label>
          <label>Module
            <select id="q-module"></select>
          </label>
        </div>
        <label>Question <input id="q-q" class="w100" /></label>
        <div id="q-mc" class="grid two gap mt">
          <input class="q-choice" placeholder="Choice 1" />
          <input class="q-choice" placeholder="Choice 2" />
          <input class="q-choice" placeholder="Choice 3" />
          <input class="q-choice" placeholder="Choice 4" />
          <label class="two">Correct option (must match exactly) <input id="q-answer-mc" class="w100" /></label>
        </div>
        <div id="q-text" style="display:none" class="grid one mt">
          <label>Correct answer (canonical)
            <input id="q-answer-text" />
          </label>
          <label>Alternate answers (pipe‑separated)
            <input id="q-alt" placeholder="answer one|Answer One" />
          </label>
        </div>
        <label>Explanation (optional)
          <input id="q-expl" />
        </label>
        <div class="row end mt">
          <button id="q-add" class="primary">Add question</button>
        </div>
        <div class="muted" id="q-count"></div>
      </div>
    </section>

    <section id="view-about" style="display:none" class="card">
      <h3>How it works</h3>
      <ul>
        <li>Leitner-based scheduling (boxes 1–5) with weighted selection.
        <li>Rewards tuned for learning: XP (+10), streak → ×multiplier, 3 hearts/session, daily quest target.
        <li>Soft penalty on wrong (box reset + tiny delay) — no hard negative XP.</li>
        <li>Install as PWA: Share → Add to Home Screen (iPhone).</li>
      </ul>
      <p class="muted">All code is plain HTML/CSS/JS. No frameworks. Easy to extend (CSV import, hints, badges) later.</p>
    </section>
  </div>

  <script defer src="leitner.js"></script>
  <script defer src="rewards.js"></script>
  <script defer src="app.js"></script>
  <script>
    // Register service worker (PWA offline)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</body>
</html>